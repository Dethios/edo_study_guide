% =============================================================================
% * GLOSSARIES AND ACRONYMS (scrbook-friendly)
%
% - Uses glossaries-extra (no indexer: makenoidxglossaries)
% - Abbrev first use: long (SHORT), thereafter: SHORT
% - Optional: reset acronym "first use" per chapter (toggle below)
% =============================================================================

\usepackage[
  stylemods=all,
  acronym,
  nonumberlist,
  nogroupskip,
  nopostdot,
  % shortcuts=ac,
  toc             % add entries to the Table of Contents (KOMA-friendly)
]{glossaries-extra}

% --- Abbreviation style: first use "Long (SHORT)", then "SHORT" -------------
% \makeatletter

% % Stop \glslink from leaving a node that preserves trailing whitespace
% \pretocmd{\@gls@link}{\@bsphack}{}{}
% \apptocmd{\@gls@link}{\@esphack\ignorespaces}{}{}

% % Donâ€™t inject the \mbox{} that \glsadd uses to force horizontal mode
% \renewcommand*{\@gls@adjustmode}{}

% \NewDocumentCommand{\silentglsadd}{m}{%
%   \IfBooleanTF{\glsentryexists{#1}}{}{%
%     \PackageWarning{edo-glossary}{Undefined glossary entry `#1' ignored}%
%     \ReturnFromDocumentCommand
%   }%
%   \@bsphack
%   \glsadd{#1}%
%   \@esphack
%   \futurelet\@let@token\silentglsadd@i
% }
% \NewDocumentCommand{\silentglsadd@i}{}{%
%   \IfBooleanTF{\token_if_eq_char:NNT \@let@token \space}{%
%     \silentglsadd@gobble
%   }{%
%     \ignorespaces
%   }%
% }
% \NewDocumentCommand{\silentglsadd@gobble}{m}{}
% \makeatother

% \glsdefpostlink{acronym}{%
%   \ifglsused{\glslabel}{}{%
%     \silentglsadd{\glslabel}%
%     \glslink{\glslabel}{(\glsentryshort{\glslabel})}%
%     \glsunset{\glslabel}%
%   }%
% }

\setabbreviationstyle[acronym]{long-short}
% --- Build mode: no external indexing (fast, good for continuous writing) ---
% Kill auto "smart space" in old glossaries/glossaries-extra
\makeatletter
% If a global autospacing flag exists, turn it off.
\@ifundefined{gls@autospacingfalse}{}{%
  \gls@autospacingfalse % old/new releases that have the flag
}%
% In older releases, \glsdoautoinsert performs the lookahead; neutralize it.
\@ifundefined{glsdoautoinsert}{}{%
  \let\glsdoautoinsert\@gobble % swallow its argument(s) and do nothing
}%
% Ensure the final space emitter does nothing.
\@ifundefined{gls@insertspace}{}{%
  \renewcommand*{\gls@insertspace}{}%
}%
\makeatother

% --- Load your acronym definitions ------------------------------------------
\loadglsentries{acronyms.def}
\makenoidxglossaries

% =========================
% Hyperlinked, no-space acronyms
% =========================
% Shared helpers for linked acronym output and smart spacing
\makeatletter
\DeclareRobustCommand{\silentglsadd}[1]{%
  \@bsphack
  \glsadd{#1}%
  \@esphack
  \futurelet\@let@token\silentglsadd@i
}
\def\silentglsadd@i{%
  \ifx\@let@token\space
    \expandafter\silentglsadd@gobble
  \else
    \ignorespaces
  \fi
}
\def\silentglsadd@gobble#1{}%
\makeatother

\NewDocumentCommand{\edoAcrLink}{m m}{\hyperlink{glo:#1}{#2}}%
\makeatletter
  \AtBeginDocument{\let\@gls@adjustmode\@empty}%
\makeatother
\NewDocumentCommand{\edoAcrRender}{m m m m}{%
  \IfBooleanTF{#1}{%
    \edoAcrLink{#2}{#3{#2}}%
  }{%
    \ifglsused{#2}{%
      \edoAcrLink{#2}{#3{#2}}%
    }{%
      \edoAcrLink{#2}{#4{#2}\silentglsadd{#2}(#3{#2})}\glsunset{#2}%
    }%
  }%
}%

% \ac{<lab>}  : first use -> long (SHORT), later -> SHORT; linked; usage tracked
% \ac*{<lab>} : always SHORT; linked; no usage change
\NewDocumentCommand{\ac}{s m}{%
  \edoAcrRender{#1}{#2}{\glsentryshort}{\glsentrylong}%
}%

% Plural
\NewDocumentCommand{\acp}{s m}{%
  \edoAcrRender{#1}{#2}{\glsentryshortpl}{\glsentrylongpl}%
}%

% Capitalized variants
\NewDocumentCommand{\Ac}{s m}{%
  \edoAcrRender{#1}{#2}{\Glsentryshort}{\Glsentrylong}%
}%
\NewDocumentCommand{\Acp}{s m}{%
  \edoAcrRender{#1}{#2}{\Glsentryshortpl}{\Glsentrylongpl}%
}%

% For list labels / moving args (optional; linked)
\NewDocumentCommand{\aclabel}{m}{%
  \hyperlink{glo:#1}{\glsentryshort{#1}}%
}%

% --- Printing notes ----------------------------------------------------------
% In main.tex you already use:
% \printnoidxglossary[type=\acronymtype, title=List of Acronyms, numberedsection, style=long-booktabs]
% You can add 'toctitle=...' there if you want a different ToC title than the heading.
